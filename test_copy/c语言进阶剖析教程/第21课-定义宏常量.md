# 第21课-定义宏常量

1、define与const定义常亮区别

  1.1、#define 定义常量本质为字面量,而const定义的是只读变量

  1.2、#define宏常量为不占内存空间，const定义变量占用内存空间

21-1.c

```c
#define ERROR 1
#define PATH "home/Desktop"
#define PATH1 home/Desktop
#define PATH2 home\
    test
int main(){

    char *p = ERROR;
    char *p2 = PATH;
    char *p3 = PATH1;
    char *p4 = PATH2;
    return 0;
}
```

gcc -E 21-1.c -o 21-1.i

21-1.i

```c
# 1 "21-1.c"
# 1 "<built-in>"
# 1 "<command-line>"
# 1 "/usr/include/stdc-predef.h" 1 3 4
# 1 "<command-line>" 2
# 1 "21-1.c"

int main(){

    char *p = 1;
    char *p2 = "home/Desktop";
    char *p3 = home/Desktop;
    char *p4 = home test;
    return 0;
}
```

21-2.c

```c
#include <stdio.h>
#define _SUM(a,b) (a)+(b)
#define _MIN(a,b) ((a)>(b) ? (b) : (a))
#define _SIZE(a) sizeof(a) /sizeof(*a)

int main(){

    int a = 1;
    int b = 2;
    int c[4] = {0};
    
    int s = _SUM(a,b);
    int m = _MIN(a++,b);
    int l = _SIZE(c);

    printf("s = %d\n",s);
    printf("m = %d\n",m);
    printf("l = %d\n",l);
    
    return 0;
}
```

gcc -E 21-2.c

```c
# 7 "21-2.c"
int main(){

    int a = 1;
    int b = 2;
    int c[4] = {0};

    int s = (a)+(b);
    int m = ((a++)>(b) ? (b) : (a++));
    int l = sizeof(c) /sizeof(*c);

    printf("s = %d\n",s);
    printf("m = %d\n",m);
    printf("l = %d\n",l);

    return 0;
}
```

a.out

```c
s = 3
m = 2
l = 4
```

1、宏定义实质，文本替换

2、功能强于函数，可求数组长度

3、实参完全替代形参，不进行任何运算？？？

4、不能进行递归调用

21-3.c

```c
#include<stdio.h>
void fun(){

    #define PI 3.1415
    #define area(a) PI*a*a
}

int main(){

    printf("area(3) = %f \n",area(3));
    return 0;
}
```

21-3.i

```c
void fun(){

}

int main(){

    printf("area(3) = %f \n",3.1415*3*3);
    return 0;
}
```

a.out

```c
area(3) = 28.273500
```

1、宏定义没有作用域

21-4.c

```c
#include<stdio.h>
#include<stdlib.h>
#define MALLOC(type,x) (type*)malloc(x*sizeof(type))
#define FOREACH(i,n) for(i=0;i<n;i++)
#define BEGAN {
#define END   }
#define FREE(P) free(p),p= NULL

#define LOG(s) printf("[%s] (%s:%d) %s\n",__DATE__,__FILE__,__LINE__,s) 

int main(){
    int x = 0;
    int *p = MALLOC(int, 5);

    LOG("begin run main code\n");

    FOREACH(x, 5)
    BEGAN
       p[x] = x;
    END
    
    FOREACH(x, 5)
    BEGAN
        printf("%d",p[x]);
    END
    printf("\n");
    
    LOG("END");
    FREE(P);

    return 0;
}
```

a.out

```c
[Oct 28 2019] (21-4.c:16) begin run main code

01234
[Oct 28 2019] (21-4.c:29) END
```

1、宏定义的使用，使代码更加简便和增强可读性

小节：

1、预处理器直接对文本替换

2、预处理不会对宏定义进行检查

3、宏使用参数时，不会带参计算